<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Lab 7 - BUAA 2023 OOP
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectre.css/0.5.9/spectre.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectre.css/0.5.9/spectre-exp.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectre.css/0.5.9/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">

    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/css/collapse.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>BUAA 2023 OOP</span>
  </a>
</div>
    <div id="menu" class="book-menu hide">
  <h1 id="课程通知"><a class="header-anchor" href="#课程通知">¶ </a><strong>课程通知</strong></h1>
<ul>
<li><a href="/2023/Homework-Notice/">作业注意事项</a></li>
</ul>
<h1 id="Lab-🔬"><a class="header-anchor" href="#Lab-🔬">¶ </a><strong>Lab 🔬</strong></h1>
<ul>
<li><a href="/2023/Lab-1/"><s>Lab 1</s></a></li>
<li><a href="/2023/Lab-2/"><s>Lab 2</s></a></li>
<li><a href="/2023/Lab-3/"><s>Lab 3</s></a></li>
<li><a href="/2023/Lab-4/"><s>Lab 4</s></a></li>
<li><a href="/2023/Lab-5/"><s>Lab 5</s></a></li>
<li><a href="/2023/Lab-6/"><s>Lab 6</s></a></li>
<li><a href="/2023/Lab-7/"><s>Lab 7</s></a></li>
<li><a href="/2023/Lab-8/"><s>Lab 8</s></a></li>
<li><a href="/2023/Lab-9/"><s>Lab 9</s></a></li>
<li><a href="/2023/Lab-10/">Lab 10</a> ⌛</li>
<li><a href="/2023/Lab-Final/">Lab Final</a> ✨</li>
<li>All released! 🎉</li>
</ul>
<h1 id="迭代任务-📽️"><a class="header-anchor" href="#迭代任务-📽️">¶ </a><strong>迭代任务 📽️</strong></h1>
<ul>
<li><a href="/2023/Project-1/"><s>迭代一</s></a></li>
<li><a href="/2023/Project-2/"><s>迭代二</s></a></li>
<li><a href="/2023/Project-3/"><s>迭代三</s></a></li>
<li><a href="/2023/Project-4/">迭代四</a> ✨</li>
<li>All released! 🎉</li>
</ul>
<h1 id="大作业-🎯"><a class="header-anchor" href="#大作业-🎯">¶ </a><strong>大作业 🎯</strong></h1>
<ul>
<li><a href="/2023/Teamwork/">大作业要求</a></li>
</ul>
<h1 id="帮助中心-💁🏻"><a class="header-anchor" href="#帮助中心-💁🏻">¶ </a><strong>帮助中心 💁🏻</strong></h1>
<ul>
<li><a href="/2023/Configure-Java-Environment/">Java 环境配置</a></li>
<li><a href="/2023/Java-Features-Summary/">Java 8 - 17 新特性总结</a></li>
<li><a href="/2023/Lab-Template/">Lab 问答报告模板</a></li>
<li><a href="/2023/patpat-User-Guide/">patpat 使用指南</a> 💫</li>
<li><a href="/2023/Q-A/">Q &amp; A</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseover="add_inner()" onmouseleave="remove_inner()">
  <div class="sidebar-toggle-inner"></div>
</div>

<script>
function add_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.add('show')  
}

function remove_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.remove('show')
}

function sidebar_toggle() {
    let sidebar_toggle = document.querySelector('.sidebar-toggle')
    let sidebar = document.querySelector('.book-sidebar')
    let content = document.querySelector('.off-canvas-content')
    if (sidebar_toggle.classList.contains('extend')) { // show
        sidebar_toggle.classList.remove('extend')
        sidebar.classList.remove('hide')
        content.classList.remove('extend')
    }
    else { // hide
        sidebar_toggle.classList.add('extend')
        sidebar.classList.add('hide')
        content.classList.add('extend')
    }
}
</script>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <h1 id="Lab-7-No-Name"><a class="header-anchor" href="#Lab-7-No-Name">¶ </a>Lab 7: No Name</h1>
<div class="admonition error"><p>本次 Lab 时长为 <strong>2</strong> 周，DDL 为 <strong>11 月 6 日 23:59</strong>。</p>
</div>
<div class="admonition note"><p>附件下载（包括问答题和实验报告模板）：<a target="_blank" rel="noopener" href="https://bhpan.buaa.edu.cn/link/AA96D0CA694BB74ABFA070F38B6C527AC6">https://bhpan.buaa.edu.cn/link/AA96D0CA694BB74ABFA070F38B6C527AC6</a></p>
</div>
<h2 id="实验目的"><a class="header-anchor" href="#实验目的">¶ </a>实验目的</h2>
<ul>
<li>简单了解 <code>Object</code> 类</li>
<li>掌握重写 <code>Object </code>类中方法的能力</li>
<li>简单了解内部类、匿名类</li>
</ul>
<h2 id="写在前面"><a class="header-anchor" href="#写在前面">¶ </a>写在前面</h2>
<p>本实验假设你明白：</p>
<ul>
<li>涉及内部类时的初始化过程。</li>
<li>内部类能够访问其外部类的所有属性和方法。</li>
<li>构造内部类必须先构造外部类对象。</li>
<li>嵌套类（静态内部类）只能够访问外部类的静态属性和方法。</li>
<li>嵌套类可以直接通过类名构造。</li>
<li>匿名内部类和局部内部类中直接使用的外部数据必须是<code>final</code>的（除非是匿名类的方法的参数）<br>
上述这些语法层面的东西，可以尝试自行证明。</li>
</ul>
<p>本次实验不会涉及以下内部类的常用技巧：</p>
<ul>
<li>回调与闭包</li>
<li>事件与控制框架</li>
</ul>
<p>也不会涉及以下特殊情况：</p>
<ul>
<li>内部类的继承与覆盖</li>
<li>多重嵌套的内部类</li>
</ul>
<h2 id="实验题目"><a class="header-anchor" href="#实验题目">¶ </a>实验题目</h2>
<h3 id="Question-1：Inner-Class-（代码填空）"><a class="header-anchor" href="#Question-1：Inner-Class-（代码填空）">¶ </a>Question 1：Inner Class （代码填空）</h3>
<p>阅读下面这段代码，回答问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Outer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Inner</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">            System.out.println(<span class="comment">/*【1】*/</span>);</span><br><span class="line">            System.out.println(<span class="comment">/*【2】*/</span>);</span><br><span class="line">            System.out.println(<span class="comment">/*【3】*/</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Outer.<span class="type">Inner</span> <span class="variable">oi</span> <span class="operator">=</span> <span class="comment">/*【4】*/</span>;</span><br><span class="line">        oi.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<strong>注释部分</strong>填写代码，使程序<strong>先后输出</strong> 30、20、10。提交包含代码和运行结果的截图。</p>
<p>注意：</p>
<ul>
<li>不允许修改已经有的代码。</li>
<li>考察的是内部类的构造以及访问外部类的方法，<strong>不要用加减运算</strong>这种操作。</li>
</ul>
<h3 id="Question-2：Anonymous-Class-（代码填空）"><a class="header-anchor" href="#Question-2：Anonymous-Class-（代码填空）">¶ </a>Question 2：Anonymous Class （代码填空）</h3>
<p>阅读下面这段代码，回答问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Inter</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Outer</span> &#123;</span><br><span class="line">    <span class="comment">/* ??? */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Outer.method().show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<strong>注释部分</strong>填写代码，使程序输出 <code>DuluDulu</code>。提交包含代码和运行结果的截图。</p>
<p>注意：</p>
<ul>
<li>不允许修改已经有的代码。</li>
<li>考察的是匿名类，但是用内部类也可以实现。</li>
</ul>
<h3 id="Question-3：匿名类的-ShapeFactory（思考题）"><a class="header-anchor" href="#Question-3：匿名类的-ShapeFactory（思考题）">¶ </a>Question 3：匿名类的 ShapeFactory（思考题）</h3>
<div class="admonition info"><p>本题与 <a target="_blank" rel="noopener" href="http://localhost:4000/2023/Lab-6/#Extra-3%EF%BC%9A%E5%8C%BF%E5%90%8D%E7%B1%BB%E7%9A%84-ShapeFactory-%EF%BC%88%E7%BC%96%E7%A8%8B%E9%A2%98%EF%BC%89">Lab 6 的一道附加题</a>相同，不要求提交代码或解答，但建议实操或思考其实现。</p>
</div>
<p>在前面实验的 <code>Shape</code> 的基础上，定义一个满足如下需求的 <code>IShapeFactory</code> 接口：</p>
<ul>
<li>具有方法 <code>Shape makeShape(double a, double b)</code> ，返回一个由 a 和 b 指定大小的 形状；
<ul>
<li>参数不合法时，返回 null 或抛出异常</li>
</ul>
</li>
</ul>
<p>用单例模式 + 工厂方法模式的思想修改矩形、椭圆、菱形类：</p>
<ul>
<li>
<p>每一个类都增设一个 <code>private static IShapeFactory factory</code> 字段</p>
<blockquote>
<p>类中的 <code>factory</code> 用于生成该类的形状对象，比如 <code>Rectangle</code> 类中的 <code>factory</code>，其 <code>makeShape</code> 方法返回 <code>Rectangle</code> 对象，直接使用匿名类为 <code>factory</code> 进行静态初始化，不允许像 Extra 2 那样定义工厂类</p>
</blockquote>
</li>
<li>
<p>进行其他的修改，使外界的其他类能够获取到 <code>factory</code> 并成功构造形状对象</p>
</li>
</ul>
<p>选择你认为合适的方式编写测试类：</p>
<ul>
<li>你的测试类应该能够覆盖到所有等价类。</li>
<li>测试形式可以是单元测试，被测对象的形式可以参考之前实验中的 <code>ShapeFactoriesTest.makeShape</code> 方法。</li>
<li>在代码注释中（或者与代码一起提交一个 readme），描述你的测试计划。</li>
</ul>
<h4 id="题外话："><a class="header-anchor" href="#题外话：">¶ </a>题外话：</h4>
<p>使用匿名类，依然是为每一个形状创建了一个对应的工厂，因此本质上依然是工厂方法模式，区别在于不用显式定义新的类（据说编码过程中，起名字是最麻烦的事情）。</p>
<p>工厂方法模式的应用中，每一种工厂通常只有一个实例，因此它经常和<strong>单例模式</strong>一起被使用。</p>
<h3 id="Question-4：ShapeSequence（编程题）"><a class="header-anchor" href="#Question-4：ShapeSequence（编程题）">¶ </a>Question 4：ShapeSequence（编程题）</h3>
<div class="admonition warning"><p>这是一个主动要求大家造轮子的题，因此不允许继承或组合任何 Java 自带的容器（除了数组）。</p>
</div>
<div class="admonition info"><p>关于内部类实现迭代器，可以参考：<a target="_blank" rel="noopener" href="https://www.cs.cornell.edu/courses/JavaAndDS/iteratorIterable/04stackIterator.pdf">An iterator that is an inner class</a>。</p>
</div>
<p>在 <code>Shape</code> 的基础上，定义一个满足如下需求的 <code>ShapeSequence</code> 类：</p>
<ul>
<li>具有属性 <code>private Shape[] shapes</code></li>
<li>构造方法 <code>ShapeSequence(int size)</code>
<ul>
<li><code>size</code> 用于指定 <code>shapes</code> 的最大长度，如果 <code>size</code> 是负数，那么按照 <code>0</code> 来处理。</li>
<li>构造方法中应当对 <code>shapes</code> 进行初始化赋值，在其他过程中 <code>shapes</code> 的大小不应该被改变</li>
</ul>
</li>
<li>方法 <code>public void add(Shape shape)</code>
<ul>
<li>向 <code>shapes</code> 中添加一个新的元素</li>
<li>当 <code>shapes</code> 被填满时，什么都不做</li>
</ul>
</li>
<li>方法 <code>public String toString()</code>
<ul>
<li>返回这个容器的字符串表达，格式为 <code>[Type, Type,...]</code></li>
<li>格式中的 <code>Type</code> 是形状类型的全小写英文单词，比如 <code>rectangle、ellipse</code></li>
</ul>
</li>
<li>方法 <code>public SequenceIterator iterator() &#123;return new SequenceIterator(); &#125;</code><br>
思考：结合之后内部类的访问权限，这个返回值有问题吗？</li>
<li>具有内部类 <code>private class SequenceIterator</code>，它用于序列遍历的迭代器
<ul>
<li>默认构造方法，在被构造时，迭代器指向的位置代表数组下标 <code>0</code></li>
<li>方法 <code>public boolean isEnd()</code>，迭代器完成遍历时，返回 <code>true</code>
<ul>
<li>完成遍历不代表迭代器指向了最后一个元素，而是指向了最后一个元素的下一个位置</li>
</ul>
</li>
<li>方法 <code>public Shape current()</code>，返回当前迭代器指向位置的 <code>Shape</code> 对象
<ul>
<li><code>isEnd()</code> 是 <code>true</code> 时，访问 <code>current</code> 是非法操作</li>
</ul>
</li>
<li>方法 <code>public void moveNext()</code>，使迭代器移动到下一个元素的位置
<ul>
<li><code>isEnd()</code> 是 <code>true</code> 时，什么都不做</li>
</ul>
</li>
<li>方法 <code>public boolean equals(Object o)</code>，当 <code>o</code> 是 <code>SequenceItetator</code> 类型的、且 <code>o</code> 和 <code>this</code> 的外部类对象相同、且 <code>o</code> 和 <code>this</code> 的位置相同时，返回 <code>true</code></li>
</ul>
</li>
</ul>
<p>对于 <code>ShapeSequence</code> 的 <code>iterator</code> 方法，由于内部类是 <code>private</code>的，如果直接返回 <code>SequenceIterator</code>，是无法编译通过的。因此，你可能需要使用<strong>接口来进行实现的隐藏</strong>，具体可以参考 <a target="_blank" rel="noopener" href="https://www.cs.cornell.edu/courses/JavaAndDS/iteratorIterable/04stackIterator.pdf">An iterator that is an inner class</a>。为此，你<strong>可以更改</strong>上文给出的需求。</p>
<p><strong>编写测试类并描述你的测试计划。提交项目代码文件夹。</strong></p>
<p><strong>注意：</strong><code>toString</code> 和 <code>equals</code> 是 override 继承自 <code>Object</code> 的方法，尽量避免出现诸如 <code>ToString</code>、 <code>equals</code> 的参数类型不是 <code>Object</code> 等情况。</p>
<p>题目中省略了一些实现上必要但是方式不唯一的属性：比如你可以在 <code>ShapeSequence</code> 类中声明一个 <code>int</code> 属性来表示当前容器被填充到了什么位置；给 <code>SequenceIterator</code> 一个 <code>int</code> 属性表示当前迭代器指向的位置，当使用 <code>isEnd</code> 时，判断迭代器位置和外部类容器的填充位置进行比较。当然，你可以按自己的想法设计。</p>
<blockquote>
<p><strong>题外话</strong></p>
<ul>
<li>本题的目的是进行内部类、<code>Object</code> 相关的综合实践。</li>
<li>后续容器和泛型课程中，会引入可变长容器以及匿名类实现的迭代器。</li>
<li>虽然我们上机并不评测程序的性能，但是在实现本题的 <code>toString</code> 时，还是推荐考虑使用 <code>StringBuilder</code>。</li>
<li>你可以考虑一下不使用内部类时要如何实现迭代器：内部类为这种数据访问是否带来了足够的便利？（不要求作答）</li>
<li>为什么 <code>SequenceIterator</code> 被限定为了 <code>private</code>？（不要求作答）</li>
</ul>
</blockquote>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.svg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>Love. T.A. 🥰</div>
      <div>2023-10-24</div>
    </div>
  </div>

  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

<!-- hexo injector body_end start -->
<script src="/js/collapse.js"></script>
<!-- hexo injector body_end end --></body>
</html>


<script src="/js/book.js"></script>
